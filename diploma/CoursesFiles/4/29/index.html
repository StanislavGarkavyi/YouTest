<p>В Angular есть своя система маршрутизации, которая позволяет сопоставлять маршруты с компонентами. Но в ASP.NET Core также есть своя система маршрутизации, которая применяется для обработки запросов. С какими проблемами мы можем столкнуться? К примеру, возьмем проект из прошлой темы, где уже использовалась маршрутизация. Если внутри приложения Angular мы будем переходить по ссылкам, то у нас будет все нормально.</p>
<p></p>
<img src="../../CoursesFiles/4/29/img/1.jpg" style="width: 50%; margin-left: 25%">
<p>Однако если же мы напрямую в адресной строке браузера введем нужный нам адрес и отправим запрос, то такой запрос не будет должным образом обработан:</p>
<img src="../../CoursesFiles/4/29/img/2.jpg" style="width: 50%; margin-left: 25%">
<p>Несмотря на то, что идет обращение по тому же адресу, но во втором случае мы получим ошибку 404.</p>
<p>Когда мы переходим п ссылке или программным образом внутри приложения Angular, то применяется соответствующий API HTML5 (Pushstate API), с помощью которого меняется URL в браузере без отправки HTTP-запроса. Но когда мы вручную вводим адрес ресурса в адресной строке браузера, то браузер отправляет новый запрос к приложению ASP.NET Core.</p>
<p>В примере выше отправлялся запрос "product/1". Но у нас нет действия контроллера, который бы сопоставлялся бы с подобным запросом. Поэтому естественно мы получим ошибку. И нам необходимо добавить дополнительный код на стороне сервера, чтобы подобные запросы также бы обрабатывались приложением Angular.</p>
<p>Что в данном случае мы можем сделать? Все зависит от того, как формируется веб-страница. Либо это непосредственно статическая веб-страница, которая напрямую отправляется пользователю. Либо же это представление (файл с расширением cshtml), на котором определен код загрузки приложения Angulr.</p>
<p><b>Запросы к статическим файлам</b></p>
<p>В прошлой теме приложение Angular загружалось на статическую веб-страницу index.html, которая располагалась в проекте в папке wwwroot:</p>
<img src="../../CoursesFiles/4/29/img/3.jpg">
<p>И в этом случае нам надо, чтобы, если запрос не предназначался к статическому файлу, не предназначался ни к одному из действий контроллера, то такой в ответ на такой запрос посылался файл index.html. И в данном случае на стороне сервера мы можем использовать несколько подходов.</p>
<p><b>Метод Run</b></p>
<p>Самый простой способ - добавить в конец конвейера обработки запроса middleware, который бы отправлял файл index.html. Для этого изменим метод Configure в классе Startup:</p>
<img src="../../CoursesFiles/4/29/img/4.jpg">
<p>Таким образом, для всех запросов, которые не сопоставлены с ресурсами в приложении, будет отправляться файл wwwroot/index.html.</p>
<p>Минусом такого подхода является то, что нам сложно будет задействовать на стороне сервера обработку ошибок 404. Так как если у нс нет контролеров и действий, соответствующих запросу, то запрос все равно будет обрабатываться, правда, на стороне клиента в Angular.</p>
<p><b>Отправка файла методом контроллера</b></p>
<p>Похожий подход предоставляет отправка файла методом контроллера. Например, допустим, в проекте в папке Controllers есть следующий контроллер HomeController:</p>
<img src="../../CoursesFiles/4/29/img/5.jpg">
<p>В данном случае метод Index отправляет файл index.html.</p>
<p>В этом случае изменим метод Configure класса Startup следующим образом:</p>
<br><img src="../../CoursesFiles/4/29/img/6.jpg"><br><img src="../../CoursesFiles/4/29/img/7.jpg"><br>
<p>В данном случае для инфраструктуры MVC определено два маршрута. Первый маршрут сопоставляется с обычными контроллерами и их действиями. Второй маршрут определен с помощью метода MapSpaFallbackRoute() и сопоставляется с действием Index контроллера Home, который в данном случае отправляет в ответ пользователю файл index.html.</p>
<p><b>Запросы к действиям контроллера</b></p>
<p>Мы необязательно можем определять загрузку приложения Angular на статической html-странице. Это может быть и представление. Например, определим в проекте каталог Views/Home и в него поместим новый файл Index.cshtml:</p>
<img src="../../CoursesFiles/4/29/img/8.jpg">
<p>В данном случае представление содержит только код html, хотя при необходимости также можно определить в нем инструкции Razor, создать для него мастер страницу и т.д.</p>
<p>А метод Index контролера HomeController будет использовать это представление:</p>
<img src="../../CoursesFiles/4/29/img/9.jpg"><br><img src="../../CoursesFiles/4/29/img/10.jpg" style="width: 25%; margin-left: 30% "><br>
<p>В методе Configure класса Startup определим следующий код:</p>
<img src="../../CoursesFiles/4/29/img/11.jpg">
<p>Здесь опять же с помощью метода routes.MapSpaFallbackRoute все остальные запросы, которые не сопоставлены с другими ресурсами, будут обрабатываться методом Index контроллера HomeController.</p>
<style>p{text-indent: 25px}img{width: 100%}</style>