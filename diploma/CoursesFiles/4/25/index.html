<p>В этом руководстве рассмотрим создание приложения на ASP.NET Core в связке с Angular 7.</p>
<p>Вначале создадим проект на ASP.NET Core, который будет использовать Angular. Для проекта выберем шаблон Empty, то есть пустой шаблон.</p>
<img src="../../CoursesFiles/4/25/img/1.jpg">
<p>Также стоит отметить, что Visual Studio предоставляет шалон Angular, который сразу же позволяет создать проект с некоторой базовой структурой и с уже настроенной конфигурацией на использование Angular. Но в данном случае выберем именно шаблон Empty, чтобы полностью проконтроллировать процесс конфигурации и не создавать ничего лишнего.</p>
<p>По умолчанию новый проект ASP.NET Core не обладает никакой встроенной поддержкой работы с Angular. B вначале добавим в проект новый файл package.json, который представляет шаблон npm Configuration file:</p>
<img src="../../CoursesFiles/4/25/img/2.jpg">
<p>Изменим содержимое этого файла следующим образом:</p>
<br><img src="../../CoursesFiles/4/25/img/3.jpg"><br><img src="../../CoursesFiles/4/25/img/4.jpg">
<p>Здесь определены все необходимые пакеты фреймворка Angular, а также пакеты, которые помогут при разработке, в частности, TypeScript и Webpack.</p>
<p>Сохраним файл, и в проект будут установлены пакеты.</p>
<p>Также добавим в проект файл конфигурации TypeScript tsconfig.json:</p>
<img src="../../CoursesFiles/4/25/img/5.jpg">
<p>После добавления изменим содержимое файла следущим образом:</p>
<img src="../../CoursesFiles/4/25/img/6.jpg">
<p>Далее в проекте определим папку ClientApp, которая будет хранить файлы приложения angular. В этой папке создадим каталог app, в который добавим новый файл app.component.ts:</p>
<img src="../../CoursesFiles/4/25/img/7.jpg">
<p>В файле app.component.ts определим код главного компонента приложения:</p>
<img src="../../CoursesFiles/4/25/img/8.jpg">
<p>Также в папку ClientApp/app добавим новый файл app.module.ts, который будет представлять главный модуль приложения:</p>
<img src="../../CoursesFiles/4/25/img/9.jpg">
<p>Далее в папку ClientApp добавим новый файл main.ts, с которого будет начинатся загрузка приложения:</p>
<img src="../../CoursesFiles/4/25/img/10.jpg">
<p>Кроме собственно загрузки приложения данный файл определяет код для перезапуска приложения с помощью Hot Module при изменениях в файлах с исходным кодом.</p>
<p>И также в папку ClientApp добавим файл polyfills.ts:</p>
<img src="../../CoursesFiles/4/25/img/11.jpg">
<p>И также в корень проекта добавим новый javascript-файл webpack.config.js, который будет определять конфигурацию сборщика Webpack:</p>
<br><img src="../../CoursesFiles/4/25/img/12.jpg"><br><img src="../../CoursesFiles/4/25/img/13.jpg"><br><img src="../../CoursesFiles/4/25/img/14.jpg"><br>
<p>Таким образом, все файлы будут компилироваться в две сборки - app.js и polyfills.js, которые будут располагаться в папке wwwroot/dist.</p>
<p>Теперь добавим в проект папку wwwroot, а в эту папку - главную веб-страницу приложения index.html:</p>
<img src="../../CoursesFiles/4/25/img/15.jpg">
<p>В итоге весь проект будет выглядеть следующим образом:</p>
<img src="../../CoursesFiles/4/25/img/16.jpg" style="width: 30%">
<p>И в конце изменим файл Startup.cs:</p>
<br><img src="../../CoursesFiles/4/25/img/17.jpg"><br><img src="../../CoursesFiles/4/25/img/18.jpg"><br>
<p>С помощью метода app.UseWebpackDevMiddleware() в конвейер обработки запроса добавляется сборка приложения через webpack при запуске приложения. Кроме того, для конфигурации компонента, взаимодействующего с webpack, применяется объект WebpackDevMiddlewareOptions, у которого устанновлено свойство HotModuleReplacement = true. Это значит, что при изменения в файлах typescript, из которых собираетсяе клиентская часть приложения, веб-страница в браузере будет автоматически обновляться. И нам вручную не придется ее обновлять.</p>
<p>И также здесь добавляется поддержка статических файлов по умолчанию, чтобы мы могли напрямую выполнить запрос к файлу index.html.</p>
<p>Если проект делается под версию ASP.NET Core 2.1, то также необходимо изменить метод Main в файле Program.cs - добавить в него вызов AppContext.SetSwitch("System.Net.Http.UseSocketsHttpHandler", false);:</p>
<img src="../../CoursesFiles/4/25/img/19.jpg">
<p>В случае с версиями 2.0 и 2.2 (и другими версиями) подобных измений в методе Main делать не надо.</p>
<p>Запустим проект на выполнение, в итоге webpack соберет из файлов сборку - app.js, которая будет загружаться на главной станице:</p>
<img src="../../CoursesFiles/4/25/img/20.jpg">
<style>p{text-indent: 25px} img {width: 100%}</style>