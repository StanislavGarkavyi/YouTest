<p>Одиночка (Singleton, Синглтон) - порождающий паттерн, который гарантирует, что для определенного класса будет создан только один объект, а также предоставит к этому объекту точку доступа.</p>
<p>Когда надо использовать Синглтон? Когда необходимо, чтобы для класса существовал только один экземпляр</p>
<p>Синглтон позволяет создать объект только при его необходимости. Если объект не нужен, то он не будет создан. В этом отличие синглтона от глобальных переменных.</p>
<p>Классическая реализация данного шаблона проектирования на C# выглядит следующим образом:</p>
<img src="../../CoursesFiles/6/47/img/1.jpg">
<p>В классе определяется статическая переменная - ссылка на конкретный экземпляр данного объекта и приватный конструктор. В статическом методе getInstance() этот конструктор вызывается для создания объекта, если, конечно, объект отсутствует и равен null.</p>
<p>Для применения паттерна Одиночка создадим небольшую программу. Например, на каждом компьютере можно одномоментно запустить только одну операционную систему. В этом плане операционная система будет реализоваться через паттерн синглтон:</p><br>
<img src="../../CoursesFiles/6/47/img/2.jpg"><br>
<img src="../../CoursesFiles/6/47/img/3.jpg"><br>
<p><b>Синглтон и многопоточность</b></p>
<p>При применении паттерна синглтон в многопоточным программах мы можем столкнуться с проблемой, которую можно описать следующим образом:</p>
<img src="../../CoursesFiles/6/47/img/4.jpg">
<p>Здесь запускается дополнительный поток, который получает доступ к синглтону. Параллельно выполняется тот код, который идет запуска потока и кторый также обращается к синглтону. Таким образом, и главный, и дополнительный поток пытаются инициализровать синглтон нужным значением - "Windows 10", либо "Windows 8.1". Какое значение сиглтон получит в итоге, пресказать в данном случае невозможно.</p>
<p>Вывод программы может быть такой:</p>
<img src="../../CoursesFiles/6/47/img/5.jpg">
<p>Или такой:</p>
<img src="../../CoursesFiles/6/47/img/6.jpg">
<p>В итоге мы сталкиваемся с проблемой инициализации синглтона, когда оба потока одновременно обращаются к коду:</p>
<img src="../../CoursesFiles/6/47/img/7.jpg">
<p>Чтобы решить эту проблему, перепишем класс синглтона следующим образом:</p><br>
<img src="../../CoursesFiles/6/47/img/8.jpg"><br>
<img src="../../CoursesFiles/6/47/img/9.jpg"><br>
<p>Чтобы избежать одновременного доступа к коду из разных потоков критическая секция заключается в блок lock.</p>
<style>p{text-indent: 25px;}</style>
